import*as e from"@wordpress/interactivity";var t={d:(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const r=(o={getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store,withSyncEvent:()=>e.withSyncEvent},s={},t.d(s,o),s);var o,s;class n{constructor(e){this.actionUrl=e?.actionUrl,this.message=e.message,this.data=e.data,this.status=e.status}get isSuccess(){return"success"===this.status}get isError(){return"error"===this.status}get isProcessing(){return"processing"===this.status}}const i={STORAGE_KEY_PREFIX:"prc_form_data_",EXPIRY_HOURS:24,getStorageKey(e){return`${this.STORAGE_KEY_PREFIX}${e}`},saveFormData(e,t){try{const r={timestamp:Date.now(),fields:t.filter((e=>e.value&&!["password","hidden"].includes(e.type))).map((e=>({id:e.id,name:e.name,value:e.value,checked:e?.checked||null})))};localStorage.setItem(this.getStorageKey(e),JSON.stringify(r))}catch(e){console.warn("Failed to save form data to localStorage:",e)}},loadFormData(e){try{const t=localStorage.getItem(this.getStorageKey(e));if(!t)return null;const r=JSON.parse(t);return Date.now()>r.timestamp+60*this.EXPIRY_HOURS*60*1e3?(this.clearFormData(e),null):r.fields}catch(e){return console.warn("Failed to load form data from localStorage:",e),null}},clearFormData(e){try{localStorage.removeItem(this.getStorageKey(e))}catch(e){console.warn("Failed to clear form data from localStorage:",e)}},clearExpiredData(){try{const e=Date.now(),t=[];for(let r=0;r<localStorage.length;r++){const o=localStorage.key(r);if(o&&o.startsWith(this.STORAGE_KEY_PREFIX))try{e>JSON.parse(localStorage.getItem(o)).timestamp+60*this.EXPIRY_HOURS*60*1e3&&t.push(o)}catch(e){t.push(o)}}t.forEach((e=>localStorage.removeItem(e)))}catch(e){console.warn("Failed to clear expired form data:",e)}}},{state:a,actions:c}=(0,r.store)("prc-block/form",{state:{success:!1,error:!1,processing:!1,get submissionDisabled(){return!(0,r.getContext)().allowSubmit},get fieldsForSubmission(){const e=(0,r.getContext)(),{formFields:t}=e,o=a.formFields.filter((e=>t.includes(e.id)));return o.push({id:"captchaToken",type:"captchaToken",value:e.captchaToken,required:!1,name:"captchaToken"}),o},get inputType(){(0,r.getContext)();const{attributes:e}=(0,r.getElement)(),{id:t}=e,{formFields:o}=a;return o.find((e=>e.id===t))?.type},get inputValue(){const{attributes:e}=(0,r.getElement)(),{id:t}=e,{formFields:o}=a;return o.find((e=>e.id===t))?.value},get inputName(){const{attributes:e}=(0,r.getElement)(),{id:t}=e,{formFields:o}=a;return o.find((e=>e.id===t))?.name},get inputPlaceholder(){const{attributes:e}=(0,r.getElement)(),{id:t}=e,{formFields:o}=a;return o.find((e=>e.id===t))?.placeholder},get isInputHidden(){const{attributes:e}=(0,r.getElement)(),{id:t}=e,{formFields:o}=a;return o.find((e=>e.id===t))?.hidden},get isInputDisabled(){const{attributes:e}=(0,r.getElement)(),{id:t}=e,{formFields:o}=a;return o.find((e=>e.id===t))?.disabled},get isInputReadOnly(){const{attributes:e}=(0,r.getElement)(),{id:t}=e,{formFields:o}=a;return o.find((e=>e.id===t))?.readOnly},get isInputRequired(){const{attributes:e}=(0,r.getElement)(),{id:t}=e,{formFields:o}=a;return o.find((e=>e.id===t))?.required},get isInputChecked(){const{attributes:e}=(0,r.getElement)(),{id:t}=e,{formFields:o}=a;return o.find((e=>e.id===t))?.checked},get isInputError(){const{formFields:e}=a,{attributes:t}=(0,r.getElement)(),{id:o}=t;return e.find((e=>e.id===o))?.error||a.error},get isInputSuccess(){return a.success},get isInputProcessing(){return a.processing},get hasErrors(){return(0,r.getContext)().errors.length>0},get formMessage(){const e=(0,r.getContext)();return e?.formMessage||!1}},actions:{updateInputStateProp:(e,t,o)=>{const{formFields:s}=a,n=s.find((t=>t.id===e));n&&(n[t]=o);const{formId:c}=(0,r.getContext)();a.formFields=s,i.saveFormData(c,s)},onLabelClick:(0,r.withSyncEvent)((e=>{const t=e.target.nextElementSibling;t&&["INPUT","SELECT","TEXTAREA"].includes(t.tagName)&&t.focus()})),getInputStateProp:(e,t)=>{const{formFields:r}=a;return r.find((t=>t.id===e))?.[t]},onInputChange:(0,r.withSyncEvent)((e=>{const{value:t,id:r}=e.target;c.updateInputStateProp(r,"value",t),c.updateInputStateProp(r,"error",!1)})),onInputCheckboxClick:(0,r.withSyncEvent)((e=>{const{checked:t,id:r}=e.target;c.updateInputStateProp(r,"checked",t),c.updateInputStateProp(r,"error",!1)})),onInputFocus:(0,r.withSyncEvent)((e=>{const{id:t}=e.target;c.updateInputStateProp(t,"error",!1)})),onInputBlur:(0,r.withSyncEvent)((e=>{})),onInputMouseEnter:(0,r.withSyncEvent)((e=>{})),onInputMouseLeave:(0,r.withSyncEvent)((e=>{})),checkForRequiredFieldsWithoutValues:()=>{const e=(0,r.getContext)(),{fieldsForSubmission:t}=a;let o=!1;t.forEach((e=>{!e.required||("checkbox"===e.type||"radio"===e.type?e.checked:e.value)?c.updateInputStateProp(e.id,"error",!1):(c.updateInputStateProp(e.id,"error",!0),o=!0)})),e.stopProcessing=o},onSubmit:(0,r.withSyncEvent)((async e=>{e.preventDefault();const t=(0,r.getContext)();c.checkForRequiredFieldsWithoutValues(),t.stopProcessing||(t.submissionProcessing=null,t.captchaHidden=!1)})),onReset:()=>{const e=(0,r.getContext)();e.submissionProcessing=!1,e.captchaHidden=!0,e.submitButtonText="Submit",e.stopProcessing=!1,e.allowSubmit=!0,e.errors=[],i.clearFormData(e.formId)},onErrorClick:(0,r.withSyncEvent)((e=>{e.preventDefault();const{actionUrl:t}=e.target.dataset;t&&(window.location.href=t),c.onReset()}))},callbacks:{onFormMount:()=>{const{ref:e,attributes:t}=(0,r.getElement)();let{id:o}=t;o||(o=`prc-block-form-${Math.random().toString(36).substring(2,15)}`);const s=(e=>{const t=e.querySelectorAll("input, select, textarea, .wp-block-prc-block-form-input-password"),r=[];return t.forEach((e=>{"password"!==e.type&&e.id&&r.push(e.id)})),r})(e),n=(0,r.getContext)();n.formId=o,n.formFields=s,i.clearExpiredData();const c=i.loadFormData(o);c&&(a.formFields=a.formFields.map((e=>{const t=c.find((t=>t.id===e.id));return t&&(e.value=t?.value,e.checked=t?.checked),e})))},onCaptchaPassing:()=>{const e=(0,r.getContext)();e.captchaPassed&&(e.captchaHidden=!0)},onProcessing:()=>{const e=(0,r.getContext)();e.submissionProcessing?e.submitButtonText="Processing...":e.submitButtonText="Submit"},sendSubmission:async()=>{const e=(0,r.getContext)(),{captchaPassed:t,captchaToken:o,nonceName:s,nonceToken:c,submissionProcessing:l,stopProcessing:d,submitMethod:u,formId:m,redirectUrl:g}=e;if(!t||d||!1===l)return;e.captchaHidden=!0,e.submissionProcessing=!0;const{method:p,action:h,namespace:f}=u,{fieldsForSubmission:S}=a,b=[...S,{id:"nonce",name:s,type:"nonceToken",value:c}];if("server"===p);else if("rest"===p);else if("api"===p&&"sendToEmail"===h)console.log("onSubmit (API)",'Send To Email is still being worked on. \nWhen finished this will allow editors to easily create forms that submit the contents/fields to an email address of their choosing.\nCoupled with the new PCT IT "create group email in MS Teams" feature this will allow for a more streamlined process for creating forms that submit to an email address.');else if("api"===p){const t=(0,r.store)(f);if(t?.actions[h])try{const r=await t.actions[h](b),o=new n(r);o.isSuccess?(i.clearFormData(m),a.success=!0,g?window.location.href=g:e.formMessage=o?.message||"Form submitted successfully.",o.actionUrl&&setTimeout((()=>{window.location.href=o.actionUrl}),1e3)):(a.error=!0,e.errors.push({id:`error-${Math.random().toString(36).substring(2,15)}`,message:o?.message||"An error occurred.",actionUrl:o?.actionUrl||null}))}catch(t){console.error("onSubmit error",t),a.error=!0,e.errors.push({id:`error-${Math.random().toString(36).substring(2,15)}`,message:t?.message||"An error occurred.",actionUrl:t?.actionUrl||null})}finally{e.submissionProcessing=!1}}i.clearFormData(m)}}});
//# sourceMappingURL=index.js.map