{"version":3,"file":"table-of-contents/view.js","mappings":"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","sources":["webpack://@pewresearch/prc-block-library/webpack/bootstrap","webpack://@pewresearch/prc-block-library/webpack/runtime/define property getters","webpack://@pewresearch/prc-block-library/webpack/runtime/hasOwnProperty shorthand","webpack://@pewresearch/prc-block-library/external module \"@wordpress/interactivity\"","webpack://@pewresearch/prc-block-library/./src/table-of-contents/view.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var x = (y) => {\n\tvar x = {}; __webpack_require__.d(x, y); return x\n} \nvar y = (x) => (() => (x))\nconst __WEBPACK_NAMESPACE_OBJECT__ = x({ [\"getContext\"]: () => (__WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__.getContext), [\"getElement\"]: () => (__WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__.getElement), [\"store\"]: () => (__WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__.store) });","/**\n * WordPress Dependencies\n */\nimport { store, getContext, getElement } from '@wordpress/interactivity';\n\nconst { actions, state } = store('prc-block/table-of-contents', {\n\tactions: {\n\t\tgetInternalChaptersList: () => {\n\t\t\tconst { ref } = getElement();\n\t\t\t// check if the first level of the list has list-items with is-top-level class\n\t\t\t// if so, return the first level of the list\n\t\t\tif (\n\t\t\t\tref.querySelector(\n\t\t\t\t\t'.wp-block-prc-block-table-of-contents__list .is-top-level'\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn ref.querySelector(\n\t\t\t\t\t'.wp-block-prc-block-table-of-contents__list'\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn ref.querySelector(\n\t\t\t\t'.wp-block-prc-block-table-of-contents__list .wp-block-prc-block-table-of-contents__list'\n\t\t\t);\n\t\t},\n\t\tinitSmoothScrollClickHandler: () => {\n\t\t\tconst internalChaptersList = actions.getInternalChaptersList();\n\n\t\t\tif (!internalChaptersList) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst links = internalChaptersList.querySelectorAll('a');\n\n\t\t\tif (!links) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlinks.forEach((link) => {\n\t\t\t\tlink.addEventListener('click', (e) => {\n\t\t\t\t\tconst href = link.getAttribute('href');\n\t\t\t\t\t// If the link is a hash link, we need to smooth scroll to the hash.\n\t\t\t\t\tif (0 === href.indexOf('#')) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tconst target = document.getElementById(\n\t\t\t\t\t\t\thref.replace('#', '')\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (target) {\n\t\t\t\t\t\t\ttarget.scrollIntoView({ behavior: 'smooth' }, true);\n\t\t\t\t\t\t\t// Add the hash to the end of the URL.\n\t\t\t\t\t\t\twindow.history.pushState(null, null, href);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tonDropdownClick: (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tconst context = getContext();\n\t\t\tcontext.isDropdownOpen = !context.isDropdownOpen;\n\t\t},\n\t\tgetContextClue: (context) => {\n\t\t\t// If context.part is defined, but context.chapter and context.section are undefined, then this is a a part. If context.chapter is defined, but context.section is undefined, then this is a chapter. If context.section is defined, then this is a section.\n\t\t\tif (context.part && !context.chapter && !context.section) {\n\t\t\t\treturn 'part';\n\t\t\t} else if (context.chapter && !context.section) {\n\t\t\t\treturn 'chapter';\n\t\t\t} else if (context.section) {\n\t\t\t\treturn 'section';\n\t\t\t}\n\t\t},\n\t},\n\tcallbacks: {\n\t\t/**\n\t\t * Remap the foundSections (generated by core/heading blocks in post_content)\n\t\t * to their respective part or chapter in their `sections` property.\n\t\t */\n\t\tmapFoundSectionsToChapters: () => {\n\t\t\tconst { sectionsFound, postId, items, partsEnabled } = state;\n\n\t\t\tconsole.log('mapFoundSectionsToChapters::', state);\n\n\t\t\t// if no sectionsFound, return\n\t\t\tif (!sectionsFound) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Structure the sectionsFound object into an array of objects\n\t\t\tconst mappedSections = Object.entries(sectionsFound).map(\n\t\t\t\t([key, label]) => ({\n\t\t\t\t\tkey,\n\t\t\t\t\tlabel,\n\t\t\t\t\turl: `#${key}`,\n\t\t\t\t\titems: [],\n\t\t\t\t\tchapters: [],\n\t\t\t\t\tis_active: false,\n\t\t\t\t})\n\t\t\t);\n\n\t\t\tconst unattachedPackagePartIndex = items.findIndex(\n\t\t\t\t(part) => part.key === `unattachedPackagePart_${postId}`\n\t\t\t);\n\t\t\tif (-1 !== unattachedPackagePartIndex) {\n\t\t\t\titems[unattachedPackagePartIndex].sections = mappedSections;\n\t\t\t} else if (!partsEnabled) {\n\t\t\t\tconst activeChapterIndex = items.findIndex(\n\t\t\t\t\t(chapter) => chapter.is_active === true\n\t\t\t\t);\n\t\t\t\titems[activeChapterIndex].sections = mappedSections;\n\t\t\t} else {\n\t\t\t\tconst activePartIndex = items.findIndex((part) => {\n\t\t\t\t\treturn part.chapters.find(\n\t\t\t\t\t\t(chapter) => chapter.is_active === true\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\tconst activeChapterIndex = items[\n\t\t\t\t\tactivePartIndex\n\t\t\t\t].chapters.findIndex((chapter) => chapter.is_active === true);\n\n\t\t\t\titems[activePartIndex].chapters[activeChapterIndex].sections =\n\t\t\t\t\tmappedSections;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Determine if the current part or chapter has list items.\n\t\t * @return {boolean}\n\t\t */\n\t\thasListItems() {\n\t\t\tconst context = getContext();\n\t\t\tconsole.log('hasListItems::', { ...context });\n\t\t\tconst { part, chapter } = { ...context };\n\t\t\tif (undefined === chapter && undefined !== part) {\n\t\t\t\treturn part.sections.length > 0;\n\t\t\t} else if (undefined !== chapter) {\n\t\t\t\treturn chapter.sections.length > 0;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t/**\n\t\t * Determine if the current part or chapter is active.\n\t\t * @return {boolean}\n\t\t */\n\t\tisActive() {\n\t\t\tconst context = getContext();\n\t\t\tconst { part, chapter, section } = { ...context };\n\n\t\t\tconst itemType = actions.getContextClue(context);\n\t\t\tconsole.log('isActive::', itemType, { ...context });\n\t\t\tif ('part' === itemType) {\n\t\t\t\treturn part.is_active;\n\t\t\t}\n\t\t\tif ('chapter' === itemType) {\n\t\t\t\treturn chapter.is_active;\n\t\t\t}\n\t\t\tif ('section' === itemType) {\n\t\t\t\treturn section.is_active;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t/**\n\t\t * When the client is resized, check if the dropdown should be enabled.\n\t\t */\n\t\tonResizeToggleDropdown: () => {\n\t\t\tconst context = getContext();\n\t\t\tconst { autoDropdownEnabled, autoDropdownWidth } = context;\n\t\t\tif (!autoDropdownEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { ref } = getElement();\n\t\t\t// get the width of the ref\n\t\t\tconst width = ref.offsetWidth;\n\t\t\t// if the width is less than the autoDropdownWidth and autoDropdownEnabled is true\n\t\t\t// set isDropdown to true\n\t\t\tif (width < autoDropdownWidth && autoDropdownEnabled) {\n\t\t\t\tcontext.isDropdown = true;\n\t\t\t} else {\n\t\t\t\tcontext.isDropdown = false;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * When a click event occurs inside the window,\n\t\t * but outside the dropdown target, close the dropdown.\n\t\t * @param {*} event\n\t\t */\n\t\tonWindowClickCloseDropdown: (event) => {\n\t\t\tconst context = getContext();\n\t\t\tconst { ref } = getElement();\n\t\t\tif (!ref.contains(event.target) && context.isDropdown) {\n\t\t\t\tcontext.isDropdownOpen = false;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Scroll smoothly when clicking on a # link\n\t\t * @param {*} event\n\t\t */\n\t\tscrollSmoothly: (event) => {\n\t\t\tconsole.log('scrollSmoothly::', state, event);\n\t\t\tconst context = getContext();\n\t\t\tconst { section } = context;\n\t\t\tconst { key } = section;\n\t\t\tevent.preventDefault();\n\t\t\tconst target = document.getElementById(key);\n\t\t\tconsole.log('scrollSmoothly::', key, target);\n\t\t\tif (target) {\n\t\t\t\ttarget.scrollIntoView({ behavior: 'smooth' }, true);\n\t\t\t}\n\t\t},\n\t\t// Section Scroll\n\t\t/**\n\t\t * Initialize the watch for section scroll if this specific block has it enabled.\n\t\t */\n\t\tinitWatchForSectionScroll: () => {\n\t\t\tconst context = getContext();\n\t\t\tconst { highlightCurrentSection } = context;\n\t\t\tif (true === highlightCurrentSection) {\n\t\t\t\tstate.enableWatchForSectionScroll = true;\n\t\t\t}\n\t\t},\n\t\twatchForCurrentSection: () => {\n\t\t\tconst context = getContext();\n\t\t\tif (\n\t\t\t\t!state.enableWatchForSectionScroll &&\n\t\t\t\t!context.highlightCurrentSection\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconsole.log('watchForCurrentSection::', state, { ...context });\n\t\t\tconst { key } = context.section;\n\t\t\tconst { currentSection } = state;\n\t\t\tcontext.section.is_active = key === currentSection;\n\t\t},\n\t\t/**\n\t\t * This runs exclusivley on core/heading blocks.\n\t\t * This function watches the scroll position of the page and determines if the current\n\t\t * heading is in view. If it is, it sets the currentSection to the id of the heading.\n\t\t */\n\t\twatchForSectionScroll: () => {\n\t\t\tif (!state.enableWatchForSectionScroll) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { currentSection } = state;\n\n\t\t\t// Get the element of the core/heading block.\n\t\t\tconst { ref } = getElement();\n\t\t\tconst { id } = getContext();\n\n\t\t\t// Get the current window scroll position.\n\t\t\tconst scrollPosition = window.scrollY;\n\t\t\tconst elementPosition = ref.offsetTop;\n\t\t\tconst elementHeight = ref.offsetHeight;\n\n\t\t\tif (\n\t\t\t\tscrollPosition >= elementPosition &&\n\t\t\t\tscrollPosition <= elementPosition + elementHeight\n\t\t\t) {\n\t\t\t\tstate.currentSection = id;\n\t\t\t}\n\n\t\t},\n\t},\n});\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","y","__WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__","x","d","actions","state","store","getInternalChaptersList","ref","getElement","querySelector","initSmoothScrollClickHandler","internalChaptersList","links","querySelectorAll","forEach","link","addEventListener","e","href","getAttribute","indexOf","preventDefault","target","document","getElementById","replace","scrollIntoView","behavior","window","history","pushState","onDropdownClick","event","context","getContext","isDropdownOpen","getContextClue","part","chapter","section","callbacks","mapFoundSectionsToChapters","sectionsFound","postId","items","partsEnabled","console","log","mappedSections","entries","map","label","url","chapters","is_active","unattachedPackagePartIndex","findIndex","sections","activePartIndex","find","activeChapterIndex","hasListItems","undefined","length","isActive","itemType","onResizeToggleDropdown","autoDropdownEnabled","autoDropdownWidth","width","offsetWidth","isDropdown","onWindowClickCloseDropdown","contains","scrollSmoothly","initWatchForSectionScroll","highlightCurrentSection","enableWatchForSectionScroll","watchForCurrentSection","currentSection","watchForSectionScroll","id","scrollPosition","scrollY","elementPosition","offsetTop","elementHeight","offsetHeight"],"sourceRoot":""}